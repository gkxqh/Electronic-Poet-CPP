# Electronic-Poet-CPP

C++实现的电子诗人

在刘慈欣的科幻小说《诗云》中，一个由掌握超级技术的外星文明 "神" 创造了一款吟诗软件，可以穷尽所有汉字的排列组合，生成可能存在的所有诗歌。这个软件在海王星轨道上的量子计算机上运行，最终创造出了由所有可能的诗词组成的巨大 "诗云"。现实生活中，刘慈欣本人确实开发过一款名为 "电子诗人" 的软件，这是他在 1989 年编写的一个能够自动生成现代诗的程序。这个现实中的软件与《诗云》中的吟诗软件有着直接的灵感联系，刘慈欣曾表示，他是受到了波兰科幻作家斯坦尼斯拉夫・莱姆的《第一次旅行：特鲁尔的电子诗人》的启发，才开发了自己的电子诗人软件。

## 项目介绍

原版的电子诗人程序编写于1989年，需要 Visual Foxpro 环境运行，如今已经难以获得，网上广为流传的是诸葛恒修改版。Visual Foxpro 的最新版本是 9.0，发布于 2007 年。此后微软逐渐终止了 Visual Foxpro 的开发，也没有适配更新的操作系统，例如 Windows 10和 Windows 11。因此，要运行《电子诗人》，还得先有一台运行着 Windows XP 或 Windows 7 的电脑。
本项目的特色不在于能够写出精巧的诗，而在于写出"抽象"的诗。**使用词库和随机数生成诗句**，而不采用大语言模型。在如今的AI时代，人工智能大语言模型已经可以轻松生成优美且具有意义的诗歌，在当下回望这种古老的实现方式颇为有趣。本项目通过C++重现了电子诗人的功能，并且可以在Windows 、 macOS 、Linux 等不同平台上编译运行。

本项目现已实现WebUI界面，提供直观的用户交互体验，包括生成诗歌、保存诗歌、查看历史诗歌、导入和删除诗歌等功能，并支持深色/浅色主题切换。

## 组成介绍

该项目由主程序、词库和WebUI三部分组成：

1. **主程序**：`main.cpp` - 实现核心功能，包括诗歌生成、词库管理和Web服务器
2. **词库**：
   - `noun`（名词）
   - `verb`（动词）
   - `adjective`（形容词）
   - `sentence`（句式）
   - 词库采用UTF-8编码
3. **WebUI**：
   - `web/style.css` - 样式文件
   - `web/script.js` - 交互逻辑
   - 响应式设计，适配移动端

## C++特性

1. **面向对象设计**：使用`ElectronicPoet`类封装所有功能
2. **使用STL容器**：用`std::vector`简化内存管理
3. **使用C++字符串**：`std::string`
4. **使用C++文件流**：`std::ifstream`和`std::ofstream`
5. **异常处理**：更好的输入验证和错误处理
6. **模板函数**：使用模板实现通用的随机元素选择功能
7. **Web服务器**：集成cpp-httplib库，实现WebUI支持
8. **文件系统**：使用C++17 filesystem库处理文件操作

### 核心功能

- **生成诗歌**：输入行数，自动生成诗歌
- **保存诗歌**：为生成的诗歌添加标题并保存
- **历史诗歌**：查看所有保存的诗歌
- **诗歌导入**：支持.txt文件导入诗歌
- **诗歌删除**：删除不需要的诗歌

### 美化与交互(WebUI)

- **动态背景**：跟随鼠标运动的底纹图案效果
- **主题切换**：支持浅色、深色和跟随系统三种主题模式
- **菜单栏**：清晰的功能导航
- **响应式设计**：适配各种屏幕尺寸
- **流畅动画**：平滑的过渡效果

## 程序运作机制

1. **启动流程**：
   
   - 加载词库到内存
   - 启动Web服务器（默认端口8080）
   - 监听HTTP请求

2. **Web请求处理**：
   
   - `/` - 返回WebUI页面
   - `/generate` - 生成诗歌API
   - `/save` - 保存诗歌API
   - `/poems` - 获取诗歌列表API
   - `/poem/{title}` - 获取/删除诗歌API
   - 静态文件服务 - 提供CSS和JavaScript文件

3. **诗歌生成**：
   
   - 随机挑选一个句式
   - 根据句式中的标记（n-名词、v-动词、a-形容词）替换为对应的随机词汇
   - 返回生成的诗句

4. **诗歌存储**：
   
   - 将诗歌保存到`collection`目录下的文本文件中
   - 文件名对应诗歌标题

## 使用方法

### 编译

#### Windows

使用g++编译（需要MinGW）：

```bash
g++ main.cpp -o main.exe -lws2_32 -std=c++17
```

或使用Visual Studio编译。

#### Linux/Mac

```bash
g++ main.cpp -o main -std=c++17
```

### 运行

确保词库文件（noun、verb、adjective、sentence）与可执行文件在同一目录下，然后运行：

```bash
# Windows
main.exe

# Linux/Mac
./main
```

### 访问WebUI

服务器启动后，在浏览器中访问：

```
http://localhost:8080
```

## WebUI使用指南

1. **生成诗歌**：
   
   - 在"生成诗歌"部分输入行数（1-50）
   - 点击"生成诗歌"按钮
   - 等待诗歌生成完成

2. **保存诗歌**：
   
   - 生成诗歌后，在下方输入诗歌标题
   - 点击"保存诗歌"按钮
   - 诗歌将保存到历史记录中

3. **查看历史诗歌**：
   
   - 滚动到"历史诗歌"部分
   - 点击任意诗歌项查看完整内容
   - 悬停在诗歌项上可显示删除按钮

4. **导入诗歌**：
   
   - 在"历史诗歌"部分点击"导入诗歌"按钮
   - 选择.txt格式的诗歌文件
   - 导入的诗歌将添加到历史记录中

5. **切换主题**：
   
   - 点击右上角的主题切换按钮（太阳/月亮图标）即可切换浅色、深色模式

## 项目结构

```
Electronic-Poet-CPP/
├── main.cpp          # 主程序
├── main.exe          # 可执行文件（编译后生成）
├── noun              # 名词词库
├── verb              # 动词词库
├── adjective         # 形容词词库
├── sentence          # 句式词库
├── collection/       # 保存的诗歌目录
├── web/              # WebUI资源
│   ├── style.css     # 样式文件
│   └── script.js     # 交互逻辑
├── cpp-httplib/      # Web服务器库
└── README.md         # 项目说明
```

## 待改进方向

- 加入设置韵脚功能
- 添加诗歌分类和搜索功能
- 添加诗歌分享功能

## 技术栈

- **后端**：C++
- **Web框架**：cpp-httplib
- **前端**：HTML5, CSS3, JavaScript (ES6+)
- **CSS框架**：Font Awesome（图标）
- **构建工具**：g++

感谢刘慈欣先生的灵感。